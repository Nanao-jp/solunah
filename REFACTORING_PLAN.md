# サイト全体リファクタリング計画

## 📋 概要

SOLUNAHサイト全体のリファクタリング計画です。デリケートな機能（回転アニメーション、料金シミュレーター）は慎重に扱い、段階的に進めます。

---

## 🎯 リファクタリングの目的

1. **コードの統一性向上** - 類似パターンの統一
2. **保守性の向上** - 重複コードの削減、コンポーネント化
3. **パフォーマンス最適化** - 不要な再レンダリングの削減
4. **型安全性の向上** - TypeScriptの型定義の強化
5. **デザインシステムの統一** - スタイルの一貫性

---

## ⚠️ デリケートな機能（慎重に扱う）

### 1. 回転アニメーション
- **ファイル**: `components/ui/InteractiveYourNurseLogoSimple.tsx`
- **理由**: framer-motionの複雑なアニメーション、画像の回転・拡大・移動ロジック
- **対応**: 機能を変更せず、コード整理のみ

### 2. 料金シミュレーター
- **ファイル**: `components/ui/PricingSimulator.tsx`
- **理由**: 複雑な計算ロジック、複数日の時間スロット計算、割引計算
- **対応**: 計算ロジックは変更せず、UI部分のリファクタリングのみ

---

## 📊 現状分析

### ページ構造
- **SOLUNAHメインサイト**: `app/page.tsx`, `app/about/`, `app/services/`, etc.
- **YOUR NURSE**: `app/your-nurse/`配下
- **保険内介護**: `app/insurance-nursing/`

### コンポーネント構造
- **共通UI**: `components/ui/` (47ファイル)
- **ページコンポーネント**: `components/` (15ファイル)
- **ナビゲーション**: `components/Navigation.tsx`, `components/YourNurseNavigation.tsx`

### 重複・類似パターン
1. **ヒーローセクション**: 複数のページで類似パターン
2. **モーダル**: `CollaborationModal`, `RegularContractModal`, `CaseModal` - 共通パターンあり
3. **カードコンポーネント**: `CaseCard`, `PremiumCaseCard`, `ServiceCard`, `FeatureCard` - 類似構造
4. **セクションタイトル**: `SectionTitle`コンポーネントは統一済み

---

## 🔄 リファクタリング計画（フェーズ別）

### フェーズ1: 安全なリファクタリング（優先度: 高）

#### 1.1 モーダルコンポーネントの統一
- **現状**: 3つのモーダルが個別実装
- **目標**: 共通の`BaseModal`コンポーネントを作成
- **対象ファイル**:
  - `components/ui/CollaborationModal.tsx`
  - `components/ui/RegularContractModal.tsx`
  - `components/ui/CaseModal.tsx`
- **作業内容**:
  - `BaseModal`コンポーネントを作成（閉じるボタン、背景クリック、スクロール制御）
  - 各モーダルを`BaseModal`を使用するように変更
  - スタイルの統一

#### 1.2 カードコンポーネントの整理
- **現状**: 複数のカードコンポーネントが類似構造
- **目標**: 共通の`BaseCard`またはpropsで柔軟に対応
- **対象ファイル**:
  - `components/ui/CaseCard.tsx`
  - `components/ui/PremiumCaseCard.tsx`
  - `components/ui/ServiceCard.tsx`
  - `components/ui/FeatureCard.tsx`
- **作業内容**:
  - 共通パターンを抽出
  - 必要に応じてpropsでカスタマイズ可能に

#### 1.3 ヒーローセクションの統一
- **現状**: YOUR NURSEは`YourNurseHeroSection`で統一済み、SOLUNAHメインは個別実装
- **目標**: SOLUNAHメインも統一されたヒーローコンポーネントを使用
- **対象ファイル**:
  - `app/page.tsx`
  - `app/about/page.tsx`
  - `app/services/page.tsx`
  - `components/Hero.tsx`
- **作業内容**:
  - SOLUNAH用の`SolunahHeroSection`を作成
  - 各ページで使用

#### 1.4 型定義の整理
- **現状**: インターフェースが各ファイルに散在
- **目標**: 共通の型定義ファイルを作成
- **作業内容**:
  - `types/`ディレクトリを作成
  - 共通の型定義を`types/common.ts`に集約
  - 各コンポーネントでインポート

---

### フェーズ2: コンポーネントの最適化（優先度: 中）

#### 2.1 アニメーションの統一
- **現状**: `fadeInUp`アニメーションがインラインで定義
- **目標**: 共通のアニメーション定義を作成
- **作業内容**:
  - `utils/animations.ts`を作成
  - 共通アニメーションを定義
  - 各コンポーネントで使用

#### 2.2 スタイルの統一
- **現状**: Tailwindクラスが各コンポーネントに散在
- **目標**: 共通のスタイルユーティリティを作成
- **作業内容**:
  - `utils/styles.ts`を作成
  - よく使うスタイルパターンを関数化
  - 例: `getCardStyles()`, `getSectionStyles()`

#### 2.3 定数の整理
- **現状**: 定数が各ファイルに散在
- **目標**: 共通の定数ファイルを作成
- **作業内容**:
  - `constants/`ディレクトリを作成
  - 料金、時間、その他の定数を集約
  - 例: `constants/pricing.ts`, `constants/time.ts`

---

### フェーズ3: パフォーマンス最適化（優先度: 中）

#### 3.1 メモ化の追加
- **対象**: 重い計算や再レンダリングが多いコンポーネント
- **作業内容**:
  - `React.memo`の適切な使用
  - `useMemo`、`useCallback`の最適化
  - 不要な再レンダリングの削減

#### 3.2 画像の最適化
- **現状**: `next/image`は使用されているが、最適化の余地あり
- **作業内容**:
  - 画像のサイズ最適化
  - 遅延読み込みの確認
  - プレースホルダーの統一

---

### フェーズ4: デリケートな機能の整理（優先度: 低、慎重に）

#### 4.1 回転アニメーションの整理
- **注意**: 機能を変更せず、コード整理のみ
- **作業内容**:
  - コメントの追加
  - 変数名の明確化
  - 型定義の強化
  - **変更しない**: アニメーションロジック、framer-motionの設定

#### 4.2 料金シミュレーターの整理
- **注意**: 計算ロジックは変更せず、UI部分のリファクタリングのみ
- **作業内容**:
  - UIコンポーネントの分割
  - 計算ロジックのコメント追加
  - 型定義の強化
  - **変更しない**: 計算ロジック、時間スロット計算、割引計算

---

## 📁 新しいディレクトリ構造（提案）

```
solunah/
├── app/                    # Next.js App Router
├── components/             # コンポーネント
│   ├── ui/                # UIコンポーネント
│   └── ...                # ページコンポーネント
├── types/                  # TypeScript型定義（新規）
│   ├── common.ts
│   ├── pricing.ts
│   └── ...
├── constants/              # 定数（新規）
│   ├── pricing.ts
│   ├── time.ts
│   └── ...
├── utils/                  # ユーティリティ（新規）
│   ├── animations.ts
│   ├── styles.ts
│   └── ...
└── ...
```

---

## ✅ チェックリスト

### フェーズ1
- [ ] `BaseModal`コンポーネントの作成
- [ ] 各モーダルのリファクタリング
- [ ] カードコンポーネントの整理
- [ ] SOLUNAH用ヒーローセクションの作成
- [ ] 型定義の整理

### フェーズ2
- [ ] アニメーションの統一
- [ ] スタイルの統一
- [ ] 定数の整理

### フェーズ3
- [ ] メモ化の追加
- [ ] 画像の最適化

### フェーズ4
- [ ] 回転アニメーションの整理（慎重に）
- [ ] 料金シミュレーターの整理（慎重に）

---

## 🚨 注意事項

1. **デリケートな機能は最後に**: 回転アニメーションと料金シミュレーターは最後のフェーズで扱う
2. **段階的な実装**: 一度にすべてを変更せず、フェーズごとに実装・テスト
3. **バックアップ**: 重要な変更前にコミット
4. **テスト**: 各フェーズ完了後に動作確認
5. **ドキュメント**: 変更内容を記録

---

## 📝 実装順序の推奨

1. **フェーズ1.1**: モーダルの統一（影響範囲が小さい）
2. **フェーズ1.2**: カードコンポーネントの整理
3. **フェーズ1.3**: ヒーローセクションの統一
4. **フェーズ1.4**: 型定義の整理
5. **フェーズ2**: コンポーネントの最適化
6. **フェーズ3**: パフォーマンス最適化
7. **フェーズ4**: デリケートな機能の整理（最後に）

---

## 🎯 成功基準

- [ ] コードの重複が50%以上削減
- [ ] 型安全性が向上（anyの使用が減る）
- [ ] パフォーマンスが向上（Lighthouseスコア）
- [ ] デリケートな機能が正常に動作
- [ ] コードレビューが容易になる

---

## 📅 予定（目安）

- **フェーズ1**: 1-2週間
- **フェーズ2**: 1週間
- **フェーズ3**: 1週間
- **フェーズ4**: 1週間（慎重に）

**合計**: 約4-5週間（段階的に実装）

---

最終更新: 2024年（現在の日付）

